<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cybersecurity Controls Navigator</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      @import url('https://rsms.me/inter/inter.css');
    </style>
    <script>
      // Prevents flash of incorrect theme
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/html-to-docx-ts@1.8.0/dist/browser/html-to-docx.js"></script>
    <!-- Sarah Johnson D-ID Agent - Direct Link Method -->
    <script>
      // Sarah Johnson AI Assistant Integration
      document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Sarah Johnson AI Assistant ready');
        
        // Global function to launch Sarah Johnson D-ID agent
        window.openDIDAgent = function() {
          console.log('🎤 Sarah Johnson clicked - opening D-ID voice agent...');
          
          // D-ID Agent Share URL with clean interface
          const didAgentURL = 'https://studio.d-id.com/agents/share?id=v2_agt_D0t5wjZD&key=WVhWMGFEQjhOamRsWldJM05tWXdPVFl4WkRVMFlqZzJOMlk0WldFM09rTXdjRXhxZUhwRFlrbDBWV3QwTjFkQlEwNTZXUT09';
          console.log('🔗 Loading D-ID agent URL:', didAgentURL);
          
          // Show D-ID agent in modal overlay
          const existingModal = document.getElementById('sarah-did-modal');
          if (existingModal) {
            existingModal.remove();
          }
          
          const modal = document.createElement('div');
          modal.id = 'sarah-did-modal';
          modal.className = 'sarah-modal-full';
          modal.innerHTML = `
            <div class="sarah-overlay" style="
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: linear-gradient(135deg, #121212, #1e1e1e, #2d2d2d);
              backdrop-filter: blur(20px);
              -webkit-backdrop-filter: blur(20px);
              z-index: 10000;
              display: flex;
              align-items: center;
              justify-content: center;
              animation: fadeIn 0.3s ease-out;
            ">
              <div class="sarah-container" style="
                width: 675px;
                height: 877px;
                background: rgba(30, 30, 30, 0.85);
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
                border: 1px solid rgba(0, 173, 181, 0.4);
                border-radius: 16px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
                transition: all 0.3s ease;
                margin: auto;
              ">
                <!-- Glass morphism header -->
                <div style="
                  position: absolute;
                  top: 0;
                  left: 0;
                  right: 0;
                  height: 60px;
                  background: rgba(30, 30, 30, 0.7);
                  backdrop-filter: blur(12px);
                  border-bottom: 1px solid rgba(0, 173, 181, 0.3);
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  padding: 0 20px;
                  z-index: 10001;
                ">
                  <div style="
                    background: linear-gradient(to right, #00adb5, #00c896);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    font-weight: 600;
                    font-size: 18px;
                  ">Sarah Johnson • AI Assistant</div>
                  <div style="display: flex; gap: 10px;">
                    <button onclick="console.log('🟡 Minimize button clicked!'); window.minimizeSarah();" style="
                      background: rgba(0, 173, 181, 0.2);
                      color: #00adb5;
                      border: 1px solid rgba(0, 173, 181, 0.3);
                      width: 35px;
                      height: 35px;
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 14px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      backdrop-filter: blur(10px);
                      transition: all 0.2s ease;
                    " onmouseover="
                      this.style.background='rgba(0, 173, 181, 0.3)';
                      this.style.transform='translateY(-2px)';
                    " onmouseout="
                      this.style.background='rgba(0, 173, 181, 0.2)';
                      this.style.transform='translateY(0)';
                    ">−</button>
                    <button onclick="document.getElementById('sarah-did-modal').remove()" style="
                      background: rgba(0, 173, 181, 0.2);
                      color: #00adb5;
                      border: 1px solid rgba(0, 173, 181, 0.3);
                      width: 35px;
                      height: 35px;
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 18px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      backdrop-filter: blur(10px);
                      transition: all 0.2s ease;
                    " onmouseover="
                      this.style.background='rgba(0, 173, 181, 0.3)';
                      this.style.transform='translateY(-2px)';
                    " onmouseout="
                      this.style.background='rgba(0, 173, 181, 0.2)';
                      this.style.transform='translateY(0)';
                    ">×</button>
                  </div>
                </div>
                
                <!-- Sarah frame container -->
                <div style="
                  position: absolute;
                  top: 60px;
                  left: 0;
                  right: 0;
                  bottom: 0;
                  border-radius: 0 0 16px 16px;
                  overflow: hidden;
                  background: rgba(30, 30, 30, 0.7);
                ">
                  <iframe 
                    src="${didAgentURL}"
                    style="
                      width: 100%;
                      height: 100%;
                      border: none;
                      border-radius: 0 0 16px 16px;
                      background: transparent;
                    "
                    allow="microphone; camera"
                    title="Sarah Johnson - AI Voice Assistant"
                    onerror="console.log('❌ D-ID iframe failed to load');"
                    onload="
                      console.log('✅ D-ID iframe loaded successfully');
                      try {
                        const iframe = this;
                        setTimeout(() => {
                          try {
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            const style = iframeDoc.createElement('style');
                            style.textContent = \`
                              body { background: transparent !important; overflow: hidden !important; }
                              header, .header, [class*='header'] { display: none !important; }
                              footer, .footer, [class*='footer'] { display: none !important; }
                              nav, .nav, [class*='nav'] { display: none !important; }
                              [class*='brand'], [class*='Brand'], [class*='logo'], [class*='Logo'] { display: none !important; }
                              [class*='share'], [class*='Share'] { display: none !important; }
                              [class*='create'], [class*='Create'] { display: none !important; }
                              [class*='build'], [class*='Build'] { display: none !important; }
                              [class*='powered'], [class*='Powered'] { display: none !important; }
                              [class*='watermark'], [id*='watermark'] { display: none !important; }
                              [class*='sidebar'], [class*='menu'] { display: none !important; }
                              [data-testid*='share'], [data-testid*='create'], [data-testid*='build'] { display: none !important; }
                              button:not([class*='start']):not([class*='conversation']):not([class*='talk']):not([class*='speak']) { display: none !important; }
                              [class*='main'], [class*='content'], [class*='video'], [class*='avatar'] {
                                width: 100% !important; height: 100% !important; max-width: none !important; max-height: none !important; border-radius: 0 0 16px 16px !important;
                              }
                              * { background-color: transparent !important; border: none !important; }
                              [class*='conversation'], [class*='start'], [class*='talk'], [class*='speak'] { display: block !important; }
                              [lang='ar'], [lang='ur'] { direction: rtl !important; text-align: right !important; }
                              [lang='hi'], [lang='zh'], [lang='ja'] { font-family: system-ui, -apple-system, sans-serif !important; }
                            \`;
                            iframeDoc.head.appendChild(style);
                            console.log('✅ D-ID interface cleaned - focusing on Sarah only');
                          } catch (e) { console.warn('⚠️ Could not access iframe content (CORS):', e.message); }
                        }, 2000);
                      } catch (e) { console.warn('⚠️ Iframe onload error:', e.message); }
                    "
                  ></iframe>
                </div>
              </div>
            </div>
            
            <style>
              @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
              .sarah-modal-full { animation: fadeIn 0.3s ease-out; }
              .sarah-modal-full .sarah-overlay { display: flex; align-items: center; justify-content: center; pointer-events: auto; }
              .sarah-modal-full .sarah-container { position: relative; margin: auto; }
              .sarah-modal-minimized { pointer-events: none; }
              .sarah-modal-minimized .sarah-overlay { background: transparent !important; backdrop-filter: none !important; pointer-events: none !important; }
              .sarah-modal-minimized .sarah-container {
                pointer-events: all !important; position: fixed !important; bottom: 20px !important; left: 50% !important; top: auto !important; right: auto !important;
                width: 300px !important; height: 400px !important; transform: translateX(-50%) scale(0.4) !important; transition: all 0.5s ease !important;
                margin: 0 !important; z-index: 10001 !important;
              }
              .sarah-modal-minimized .sarah-container:hover { transform: translateX(-50%) scale(0.45) translateY(-10px); box-shadow: 0 15px 35px rgba(0, 173, 181, 0.4); }
              .sarah-modal-full .sarah-container:hover { transform: translateY(-5px); box-shadow: 0 20px 50px rgba(0, 173, 181, 0.3); }
            </style>
          `;
          document.body.appendChild(modal);
          console.log('✅ D-ID Voice Agent opened successfully!');
          return true;
        };
        
        window.minimizeSarah = function() {
          const modal = document.getElementById('sarah-did-modal');
          if (modal) {
            modal.className = 'sarah-modal-minimized';
            const container = modal.querySelector('.sarah-container');
            if (container) {
              container.onclick = function() { window.restoreSarah(); };
              container.style.cursor = 'pointer';
            }
          }
        };
        
        window.restoreSarah = function() {
          const modal = document.getElementById('sarah-did-modal');
          if (modal) {
            modal.className = 'sarah-modal-full';
            const container = modal.querySelector('.sarah-container');
            if (container) {
              container.onclick = null;
              container.style.cursor = 'default';
            }
          }
        };
        
        console.log('✅ Sarah Johnson voice agent ready - click her picture to start conversation');
      });
    </script>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.16.0"
  }
}
</script>
</head>
  <body class="bg-gray-50 dark:bg-gray-900">
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, err => {
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>